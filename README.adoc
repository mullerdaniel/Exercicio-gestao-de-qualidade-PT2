= Sistema de Gestão de Qualidade e Manutenção Industrial

== 1. EquipamentoService

Serviço básico para operações de CRUD em `Equipamento`.

=== Métodos a Implementar

==== 1. `Equipamento criarEquipamento(Equipamento equipamento)`

* **Parâmetros:** `Equipamento equipamento`
* **Retorno:** `Equipamento`
* **Lógica:**
  Salvar um equipamento com status operacional.

==== 2. `Equipamento buscarEquipamentoPorId(long id)`

* **Parâmetros:** `long id`
* **Retorno:** `Equipamento`
* **Lógica:**
  Validar se o equipamento existe.
  Se não existir, lançar `RuntimeException` com a mensagem:

```
Equipamento não encontrado!
```

Se existir, retornar o equipamento completo.

---

== 2. FalhaService (Lógica Crítica de Negócio)

Este serviço orquestra o registro de falhas e suas consequências imediatas.

=== Métodos a Implementar

==== 1. `Falha registrarNovaFalha(Falha falha)`

* **Parâmetros:** `Falha falha`
* **Retorno:** `Falha`
* **Lógica (Transacional):**

- Validar se o equipamento existe.
  Se não existir, lançar:

```
IllegalArgumentException: Equipamento não encontrado!
```

* Salvar a falha com status `ABERTA`.

**Regra de Negócio:**
Se a falha tiver criticidade **CRITICA**, atualizar o status do equipamento para `EM_MANUTENCAO`.

---

==== 2. `List<Falha> buscarFalhasCriticasAbertas()`

* **Parâmetros:** Nenhum
* **Retorno:** `List<Falha>`
* **Lógica:**
  Buscar falhas com:

```
status = 'ABERTA'
criticidade = 'CRITICA'
```

Retornar a lista resultante.

---

== 3. AcaoCorretivaService

=== Métodos a Implementar

==== 1. `AcaoCorretiva registrarConclusaoDeAcao(AcaoCorretiva acao)`

* **Parâmetros:** `AcaoCorretiva acao`
* **Retorno:** `AcaoCorretiva`
* **Lógica:**

- Validar se o id da falha é válido.
  Se não for, lançar `RuntimeException`.
- Salvar a ação corretiva.

**Regras de Negócio:**

1. Atualizar o status da falha para `RESOLVIDA`.
2. Se a falha for `CRITICA`, atualizar o equipamento para `OPERACIONAL`.

---

== 4. RelatorioService

=== Métodos a Implementar

==== 1. `List<RelatorioParadaDTO> gerarRelatorioTempoParada()`

* **Parâmetros:** Nenhum
* **Retorno:** `List<RelatorioParadaDTO>`

---

==== 2. `List<Equipamento> buscarEquipamentosSemFalhasPorPeriodo(LocalDate dataInicio, LocalDate dataFim)`

* **Parâmetros:**
  `LocalDate dataInicio`, `LocalDate dataFim`
* **Retorno:** `List<Equipamento>`
* **Lógica:**
  Buscar equipamentos que não tiveram falhas no período informado.

---

==== 3. `Optional<FalhaDetalhadaDTO> buscarDetalhesCompletosFalha(long falhaId)`

* **Parâmetros:** `long falhaId`
* **Retorno:** `FalhaDetalhadaDTO`
* **Lógica:**
  Validar se o id da falha é válido.
  Se não for, lançar `RuntimeException`.

---

==== 4. `List<EquipamentoContagemFalhasDTO> gerarRelatorioManutencaoPreventiva(int contagemMinimaFalhas)`

* **Parâmetros:** `int contagemMinimaFalhas`
* **Retorno:** `List<EquipamentoContagemFalhasDTO>`
* **Lógica:**
  Validar se o valor informado é maior que zero.
  Se não for, lançar `RuntimeException`.
  Se for válido, buscar equipamentos que tenham **quantidade de falhas maior ou igual** ao valor informado.

---

= Tabelas do Banco de Dados

== `Equipamento`
Armazena os ativos físicos da planta.

## [source,sql]

CREATE TABLE IF NOT EXISTS Equipamento (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
nome VARCHAR(255) NOT NULL,
numeroDeSerie VARCHAR(100) NOT NULL UNIQUE,
areaSetor VARCHAR(100) NOT NULL,
statusOperacional VARCHAR(50) NOT NULL,

```
CONSTRAINT chk_status_equipamento CHECK (
    statusOperacional IN ('OPERACIONAL', 'EM_MANUTENCAO', 'INATIVO')
)
```

## );

== `Falha`
Registra cada ocorrência de falha vinculada a um equipamento.

## [source,sql]

CREATE TABLE IF NOT EXISTS Falha (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
equipamentoId BIGINT NOT NULL,
dataHoraOcorrencia DATETIME NOT NULL,
descricao TEXT NOT NULL,
criticidade VARCHAR(50) NOT NULL,
status VARCHAR(50) NOT NULL,
tempoParadaHoras DECIMAL(10, 2) DEFAULT 0.00,

```
CONSTRAINT chk_criticidade_falha CHECK (
    criticidade IN ('BAIXA','MEDIA','ALTA','CRITICA')
),
CONSTRAINT chk_status_falha CHECK (
    status IN ('ABERTA','EM_ANDAMENTO','RESOLVIDA')
),

CONSTRAINT fk_falha_equipamento
    FOREIGN KEY (equipamentoId)
    REFERENCES Equipamento(id)
    ON DELETE RESTRICT
```

## );

== `AcaoCorretiva`
Detalha as ações tomadas para resolução de uma falha.

## [source,sql]

CREATE TABLE IF NOT EXISTS AcaoCorretiva (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
falhaId BIGINT NOT NULL,
dataHoraInicio DATETIME NOT NULL,
dataHoraFim DATETIME NOT NULL,
responsavel VARCHAR(255) NOT NULL,
descricaoAcao TEXT NOT NULL,

```
CONSTRAINT fk_acao_falha
    FOREIGN KEY (falhaId)
    REFERENCES Falha(id)
    ON DELETE RESTRICT
```

## );
